import{R as e,w as t,a as l,C as n,b as r,c as o,W as a,s,t as c,d as i,o as u,e as m,f as p,l as y,g as f,h as d,B as g,L as h,S as x,i as E,j as b,k as v}from"./vendor.5a7301c6.js";const S=e({key:"collected",default:{},dangerouslyAllowMutability:!0});let k=null;t(l.MoveNet).then((e=>k=e));const R=()=>{let[e,t]=n.exports.useState(!1),[l,s]=n.exports.useState({}),[c,i]=r(S),[u,m]=n.exports.useState(null),p=n.exports.useRef(null),y=n.exports.useRef(null);const f=n.exports.useRef(e);f.current=e;const d=n.exports.useRef(u);d.current=u,n.exports.useEffect((()=>{let e,t,l,n=async()=>{try{const{keypoints:n}=(await k.estimatePoses(p.current.video))[0];f.current&&s((e=>{let r=d.current;return e[r]instanceof Array||(e[r]=[]),e[r].push(n.map((({x:e,y:n})=>({x:e/t,y:n/l})))),e}));let{x:o,y:a,score:c}=n[5],{x:i,y:u,score:m}=n[6],y={x:(o+i)/2,y:(a+u)/2,score:(c+m)/2},{x:g,y:h,score:x}=n[3],{x:E,y:b,score:v}=n[4],S={x:(g+E)/2,y:(h+b)/2,score:(x+v)/2};n.push(y),n.push(S),r(n,e)}catch(o){console.log(o)}p.current&&requestAnimationFrame(n)},r=(e,n)=>{n.clearRect(0,0,t,l),n.fillStyle="rgba(0,0,0,.7)",n.fillRect(0,0,t,l);let{x:r,y:o,score:a}=e[1],{x:s,y:c,score:i}=e[2];n.lineWidth=.2*Math.hypot(r-s,o-c),n.strokeStyle="rgba(155,0,100,.7)",n.fillStyle="rgba(155,0,100,.7)",[[4,2],[2,0],[0,1],[1,3],[5,7],[7,9],[6,8],[8,10],[5,6],[18,17],[5,11],[6,12],[11,13],[13,15],[11,12],[12,14],[14,16]].map((t=>{let l=!0;n.beginPath(),t.map(((t,r)=>{let{x:o,y:a,score:s}=e[t];s<.3&&(l=!1),0===r?n.moveTo(o,a):n.lineTo(o,a)})),l&&n.stroke()})),e.map((({x:e,y:t,score:l})=>{l>.3&&(n.beginPath(),n.arc(e,t,6,0,2*Math.PI),n.fill())}))};p.current.video.addEventListener("loadeddata",(()=>{let{top:r,left:o,height:a,width:s}=p.current.video.getBoundingClientRect();y.current.height=a,y.current.width=s,t=s,l=a,e=y.current.getContext("2d"),n()}))}),[]);return o.createElement(o.Fragment,null,o.createElement("canvas",{style:{position:"absolute"},ref:y}),o.createElement(a,{ref:p}),o.createElement("hr",null),"class name: ",o.createElement("input",{onChange:({target:e})=>{m(e.value),t(!1)}}),o.createElement("button",{onClick:()=>{console.log("!"),setTimeout((()=>console.log("3...")),1e3),setTimeout((()=>console.log("2...")),2e3),setTimeout((()=>console.log("1...")),3e3),setTimeout((()=>{console.log("0!"),t(!0)}),4e3),setTimeout((()=>{console.log("stop"),t(!1),i((()=>l))}),1e4)}},"record"),e&&"recording",o.createElement("pre",{style:{height:"300px",background:"#efefef",overflow:"scroll"}},JSON.stringify(l,null,2)))};let w=s();const C=()=>{let[e,t]=r(S),[l,a]=n.exports.useState(null);return o.createElement(o.Fragment,null,o.createElement("button",{onClick:()=>{let t=Object.keys(e),l=[],n=[];for(const[a,c]of t.entries()){let t=a;e[c].map((e=>{let r=e.map((({x:e,y:t})=>[e,t])).flat();l.push(r),n.push(t)}))}console.log(l,n);let r=c(n,"int32"),o=i(l),s=u(r,t.length);console.log(o.shape,s.shape),o.print(),s.print();let y=m({units:16,activation:"sigmoid",inputDim:34}),f=m({units:t.length,activation:"softmax"});w.add(y),w.add(f);let d=p.sgd(.2);w.compile({optimizer:d,loss:"categoricalCrossentropy"}),w.fit(o,s,{epochs:100,shuffle:!0,callbacks:{onEpochEnd:(e,t)=>{a(t.loss)}}})}},"run 100 epochs"),o.createElement("button",{onClick:async()=>{const e=await w.save("downloads://"+ +new Date);console.log(e)}},"download"),o.createElement("textarea",{onChange:e=>t(JSON.parse(e.target.value)),defaultValue:JSON.stringify(e)}),o.createElement("p",null,"loss: ",l))};let M=null;t(l.MoveNet).then((e=>M=e));let T=null;const P=()=>{let e=n.exports.useRef(null),t=n.exports.useRef(null),l=n.exports.useRef(null),r=n.exports.useRef(null),[s,c]=n.exports.useState(null);n.exports.useEffect((()=>{let l,n,r,o=async()=>{let t=null;try{const{keypoints:n}=(await M.estimatePoses(e.current.video))[0];if(null!==T){let e=n.map((({x:e,y:t})=>[e,t])).flat(),l=i([e]);t=T.predict(l).argMax(1).dataSync()[0]}let{x:r,y:o,score:s}=n[5],{x:c,y:u,score:m}=n[6],p={x:(r+c)/2,y:(o+u)/2,score:(s+m)/2},{x:y,y:f,score:d}=n[3],{x:g,y:h,score:x}=n[4],E={x:(y+g)/2,y:(f+h)/2,score:(d+x)/2};n.push(p),n.push(E),a(n,l,t)}catch(n){console.log(n)}requestAnimationFrame(o)},a=(e,t,l)=>{let o=null===l?"rgba(155,0,100,.7)":["rgba(255,0,0,.7)","rgba(0,0,255,.7)"][l];t.clearRect(0,0,n,r),t.fillStyle="rgba(0,0,0,.7)",t.fillRect(0,0,n,r);let{x:a,y:s,score:c}=e[1],{x:i,y:u,score:m}=e[2];t.lineWidth=.2*Math.hypot(a-i,s-u),t.strokeStyle=o,t.fillStyle=o,[[4,2],[2,0],[0,1],[1,3],[5,7],[7,9],[6,8],[8,10],[5,6],[18,17],[5,11],[6,12],[11,13],[13,15],[11,12],[12,14],[14,16]].map((l=>{let n=!0;t.beginPath(),l.map(((l,r)=>{let{x:o,y:a,score:s}=e[l];s<.3&&(n=!1),0===r?t.moveTo(o,a):t.lineTo(o,a)})),n&&t.stroke()})),e.map((({x:e,y:l,score:n})=>{n>.3&&(t.beginPath(),t.arc(e,l,6,0,2*Math.PI),t.fill())}))};e.current.video.addEventListener("loadeddata",(()=>{let{top:a,left:s,height:c,width:i}=e.current.video.getBoundingClientRect();t.current.height=c,t.current.width=i,n=i,r=c,l=t.current.getContext("2d"),o()}))}),[]);return o.createElement(o.Fragment,null,o.createElement("canvas",{style:{position:"absolute"},ref:t}),o.createElement(a,{ref:e}),o.createElement("hr",null),"JSON: ",o.createElement("input",{type:"file",ref:l})," ",o.createElement("br",null),"BIN: ",o.createElement("input",{type:"file",ref:r})," ",o.createElement("br",null),o.createElement("button",{onClick:async()=>{let e=l.current.files[0],t=r.current.files[0];T=await y(f([e,t]))}},"loadModel"),"prediction: ",s)},N=()=>o.createElement(d,null,o.createElement(g,null,o.createElement("nav",null,o.createElement(h,{to:"/collect"},"Collect"),o.createElement(h,{to:"/train"},"Train"),o.createElement(h,{to:"/classify"},"Classify")),o.createElement(x,null,o.createElement(E,{path:"/collect"},o.createElement(R,null)),o.createElement(E,{path:"/train"},o.createElement(C,null)),o.createElement(E,{path:"/classify"},o.createElement(P,null)),o.createElement(b,{from:"/",to:"/collect"}))));v.render(o.createElement(o.StrictMode,null,o.createElement(N,null)),document.getElementById("root"));
