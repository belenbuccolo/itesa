<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@0.4.2/dist/mindar.prod.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-firestore.js"></script>
  <script>

    document.addEventListener("DOMContentLoaded", function () {

      const userId = window.location.hash.split("id:")[1]

      const getProducts = async () => {
        let productos = await db.collection("productosParaEscanear").get();
        return productos.docs.map((producto) => producto.data());
      };
      getProducts().then((data) => {
        console.log(data);
      });


      const targetGatorade = document.querySelector('#gatorade');

      // detect target found
      targetGatorade.addEventListener("targetFound", event => {
        db.collection("users")
          .doc(userId)
          .get()
          .then((res) => {
            return res.data();
          })
          .then((data) => {
            db.collection("users").doc(userId).update({
              points: 200
            })
            alert("sumaste 200 puntos")
          })
          .catch((err) => console.log(err))
      });
    });

  </script>
</head>

<body>
  <a-scene mindar="imageTargetSrc: /mindar/gatoradeJoaco2.mind; showStats: false;" color-space="sRGB"
    renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false">
    <a-assets>
      <a-asset-item id="avatarModel" src="/itesa3.gltf"></a-asset-item>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity id="gatorade" mindar-image-target="targetIndex: 0">
      <a-gltf-model rotation="0 0 0 " position="0 0 0.1" scale="0.003 0.003 0.003" src="#avatarModel"
        animation="property: position; to: 0 0.1 0.1; dur: 1000; easing: easeInOutQuad; loop: true; dir: alternate">
    </a-entity>
  </a-scene>
  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBWn9kzojV6c3K18CS8aFLboteECg1njXU",
      authDomain: "itesa-p5.firebaseapp.com",
      projectId: "itesa-p5",
      storageBucket: "itesa-p5.appspot.com",
      messagingSenderId: "159222681310",
      appId: "1:159222681310:web:31146d63cfc48d0df97c4f"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</body>

</html>